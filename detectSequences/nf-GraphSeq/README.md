# Get non-reference sequences from a pg graph
## Introduction
The different script are run in a nextflow workflow to extract the sequences in the graph that are not present into any of the reference paths.

## Dependencies
Before running the workflow, you'll need to have `cmake > 3.10` installed, with the `CMAKE_C_COMPILER` and `CMAKE_CXX_COMPILER` set as environment variables.
The workflow will install all the dependencies using `environment.yml` file. Will then run all the processes in sequence, to identify, filter, combine and simplify the resulting regions.
Finally, it will perform a detection of novel genes in the regions.

## Note for the users
At the moment, this workflow does not support the VG files generated using the [cactus pangenome workflow](https://github.com/ComparativeGenomicsToolkit/cactus/blob/master/doc/pangenome.md). To use this version of the workflow, you need to have generated the graph using the standard [progressive cactus](https://github.com/ComparativeGenomicsToolkit/cactus/blob/master/doc/progressive.md) workflow, and then convert manually the resulting alignments to PG using [hal2vg](https://github.com/ComparativeGenomicsToolkit/hal2vg).

## Inputs
The workflow requires the following inputs:
1. `--pg`: PG graph generated by converting a cactus hal alignment to vg-compliant format using [hal2vg](https://github.com/ComparativeGenomicsToolkit/hal2vg)
2. `--genome_pool`: A single fasta file with all the assemblies present in the graph genome, with the sequence naming in the format `GENOME.SEQUENCE`
3. `--contigs`: list of short sequences in all the assemblies (same naming convention as the pooled fasta file)
4. `--scaffolds`: list of scaffolded sequences in all the assemblies (i.e. the chromosomes of megabase-level fragments, same naming convention as the pooled fasta file)
5. `--repetitiveness`: proportion of masked base in each sequence, in the format `SEQID\tBPmasked\tBPtot\tPercMasked` (for example by using the script [here](https://github.com/evotools/CattleGraphGenomePaper/blob/master/detectSequences/MAF_WORKFLOW/SCRIPTS/CountLowerCaseBases.py))
6. `--reference` : name of the reference genome
7. `--proteins`: file with the protein database used to align to the novel sequence
8. `--flanks`: Flanking sequence to consider when predicting the gene elements with Augustus
9. `--gap_flanks`: Every novel sequence within this distance from a gap will be tagged as near-gap sequence
10. `--novelty_cutoff`: minimum proportion of non-reference bases in a sequence to be considered novel; below it, it will be tagged as haplotype.
11. `--frc`: list of misassembled regions predicted by FRCAlign or similar algorithms; optional.

## Notes
The workflow still needs to be tested extensively. However, in the legacy folder we provide the scripts used to perform the analysis, numbered by stage.
